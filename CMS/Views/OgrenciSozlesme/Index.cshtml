@{
    string pageTitle_OgrenciSozlesme = "Sözleşme";
    string control_Name_OgrenciSozlesme = "OgrenciSozlesme";

}

<script type="text/javascript">
    var control_Name_OgrenciSozlesme = "@control_Name_OgrenciSozlesme";
    var dt_OgrenciSozlesme = "#dt_" + control_Name_OgrenciSozlesme;
</script>



<!-- begin:: OgrenciSozlesme -->
<div class="kt-container  kt-grid__item kt-grid__item--fluid">

    <div class="kt-portlet kt-portlet--mobile">
        <div class="kt-portlet__head kt-portlet__head--lg">
            <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon">
                    <i class="kt-font-brand flaticon2-line-chart"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                    @Html.Raw(pageTitle_OgrenciSozlesme)
                </h3>
            </div>
            <div class="kt-portlet__head-toolbar">
                <div class="kt-portlet__head-wrapper">
                    <div class="kt-portlet__head-actions">


                        <a href="/@control_Name_OgrenciSozlesme/InsertOrUpdatePage" class="btn btn-brand btn-elevate btn-icon-sm">
                            <i class="la la-plus"></i>
                            @Html.Raw(pageTitle_OgrenciSozlesme + " Ekle")
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="kt-portlet__body">
            <!--begin: Datatable -->
            <table id="dt_@control_Name_OgrenciSozlesme" class="table table-striped- table-bordered table-hover table-checkable">
                <thead>
                    <tr>
                    </tr>
                </thead>


            </table>
            <!--end: Datatable -->
        </div>
    </div>
</div>
<!-- end:: OgrenciSozlesme -->



<script type="text/javascript">
    var OgrenciSozlesme_ListFunc;
    $(function () {
        OgrenciSozlesme_ListFunc = {
            load: function () {
                OgrenciSozlesme_ListFunc.GetPaging();

            },

            GetPaging: function () {

                var columns = [];
                columns.push({ "data": "SubeAd", text: "Şube" });
                columns.push({ "data": "OgrenciAd", text: "Öğrenci" });
                columns.push({ "data": "SozlesmeTurAd", text: "Sözleşme Türü" });
                columns.push({ "data": "ReferansAdSoyad", text: "Referans" });
                columns.push({ "data": "GorusenPersonelAd", text: "Görüşen Personel" });
                columns.push({ "data": "KurumaGetirenPersonelAd", text: "Kuruma Getiren Personel" });
                columns.push({ "data": "SezonAd", text: "Sezon" });
                columns.push({ "data": "ServisAd", text: "Servis" });
                columns.push({ "data": "FinansorAd", text: "Finansor" });
                columns.push({ "data": "FaturaAd", text: "Fatura Ad" });
                columns.push({ "data": "FaturaSoyad", text: "Fatura Soyad" });
                columns.push({ "data": "VergiNo", text: "VergiNo" });
                columns.push({ "data": "VergiDairesi", text: "Vergi Dairesi" });
                columns.push({ "data": "EgitimTutar", text: "Egitim Tutar" });
                columns.push({ "data": "ServisTutar", text: "Servis Tutar" });
                columns.push({ "data": "YayinTutar", text: "Yayin Tutar" });
                columns.push({ "data": "ToplamTutar", text: "Toplam Tutar" });
                columns.push({ "data": "PesinatTutari", text: "Pesinat Tutari" });
                columns.push({ "data": "TaksitAdet", text: "Taksit Adet" });
                columns.push({ "data": "TaksitBaslangic", text: "Taksit Baslangic Tarihi" });
                columns.push({ "data": "DersAdedi", text: "Ders Adedi" });
                columns.push({ "data": "DersBirimTutar", text: "Ders Birim Tutar" });



                columns.push({ "data": "Detail", text: "İşlemler" });

                $.each(columns, function (i, item) {
                    $(dt_OgrenciSozlesme + ' thead tr').append('<td>' + item.text + '</td>');
                });


                var table = $(dt_OgrenciSozlesme).DataTable({
                    "ajax": {
                        "url": '/' + control_Name_OgrenciSozlesme + '/GetPaging',
                        "type": "POST",
                        "datatype": "json",
                        "data": function (searchModel) {
                            $(dt_OgrenciSozlesme).LoadingOverlay("show");
                            searchModel.pagingSearchParam = 'Ad';
                        },
                        "dataSrc": function (json) {
                            return_data = new Array();
                            var data = json.data;

                            $.each(data, function (i, row) {

                                var Detail = "";
                                Detail += '<a class="btn btn-sm btn-clean btn-icon btn-icon-md" href ="/' + control_Name_OgrenciSozlesme + '/InsertOrUpdatePage?id=' + row.Id + '"  title="Düzenle" > ' + '<i class="la la-edit"></i>' + ' </a > ';
                                Detail += '<a class="btn btn-sm btn-clean btn-icon btn-icon-md btnDelete" dataid="' + row.Id + '" title="Sil" > ' + '<i class="la la-remove"></i>' + '  </a>';

                                columns.push({ "data": "SubeAd", text: "Şube" });
                                columns.push({ "data": "OgrenciAd", text: "Öğrenci" });
                                columns.push({ "data": "SozlesmeTurAd", text: "Sözleşme Türü" });
                                columns.push({ "data": "ReferansAdSoyad", text: "Referans" });
                                columns.push({ "data": "GorusenPersonelAd", text: "Görüşen Personel" });
                                columns.push({ "data": "KurumaGetirenPersonelAd", text: "Kuruma Getiren Personel" });
                                columns.push({ "data": "SezonAd", text: "Sezon" });
                                columns.push({ "data": "ServisAd", text: "Servis" });
                                columns.push({ "data": "FinansorAd", text: "Finansor" });
                                columns.push({ "data": "FaturaAd", text: "Fatura Ad" });
                                columns.push({ "data": "FaturaSoyad", text: "Fatura Soyad" });
                                columns.push({ "data": "VergiNo", text: "VergiNo" });
                                columns.push({ "data": "VergiDairesi", text: "Vergi Dairesi" });
                                columns.push({ "data": "EgitimTutar", text: "Egitim Tutar" });
                                columns.push({ "data": "ServisTutar", text: "Servis Tutar" });
                                columns.push({ "data": "YayinTutar", text: "Yayin Tutar" });
                                columns.push({ "data": "ToplamTutar", text: "Toplam Tutar" });
                                columns.push({ "data": "PesinatTutari", text: "Pesinat Tutari" });
                                columns.push({ "data": "TaksitAdet", text: "Taksit Adet" });
                                columns.push({ "data": "TaksitBaslangic", text: "Taksit Baslangic Tarihi" });
                                columns.push({ "data": "DersAdedi", text: "Ders Adedi" });
                                columns.push({ "data": "DersBirimTutar", text: "Ders Birim Tutar" });


                                return_data.push({
                                    'SubeAd': (row.Sube == null ? "" : row.Sube.Ad),
                                    'OgrenciAd': row.OgrenciDetay.OgrenciDetay.Name + ' ' + row.OgrenciDetay.OgrenciDetay.Surname,
                                    'SozlesmeTurAd': row.SozlesmeTur.Ad,
                                    'ReferansAdSoyad': row.ReferansAdSoyad,
                                    'GorusenPersonelAd': (row.GorusenPersonel == null ? "" : row.GorusenPersonel.Name + ' ' + row.GorusenPersonel.Surname),
                                    'KurumaGetirenPersonelAd': (row.KurumaGetirenPersonel == null ? "" : row.KurumaGetirenPersonel.Name + ' ' + row.KurumaGetirenPersonel.Surname),
                                    'SezonAd': (row.Sezon == null ? "" : row.Sezon.Ad),
                                    'ServisAd': (row.Servis == null ? "" : row.Servis.Ad),
                                    'FinansorAd': (row.Finansor == null ? "" : row.Finansor.Ad),
                                    'FaturaAd': row.FaturaAd,
                                    'FaturaSoyad': row.FaturaSoyad,
                                    'VergiNo': row.VergiNo,
                                    'VergiDairesi': row.VergiDairesi,
                                    'EgitimTutar': row.EgitimTutar,
                                    'ServisTutar': row.ServisTutar,
                                    'YayinTutar': row.YayinTutar,
                                    'ToplamTutar': row.ToplamTutar,
                                    'PesinatTutari': row.PesinatTutari,
                                    'TaksitAdet': row.TaksitAdet,
                                    'TaksitBaslangic': row.TaksitBaslangic,
                                    'DersAdedi': row.DersAdedi,
                                    'DersBirimTutar': row.DersBirimTutar,

                                    'Detail': Detail,
                                })

                            });
                            return return_data;
                        }
                    },
                    "fnDrawCallback": function (settings, json) {
                        $(dt_OgrenciSozlesme + ' .btnDelete').click(function () {
                            var dataid = $(this).attr("dataid");
                            alerts("Silinsin mi ?", "yesno", function (result) {
                                if (result == true) {
                                    $(dt_OgrenciSozlesme).LoadingOverlay("show");
                                    $.ajx('/' + control_Name_OgrenciSozlesme + "/Delete", { id: dataid }, function (resultData) {
                                        if (resultData && resultData.IsDeleted) {
                                            table.ajax.reload();
                                        }
                                        else {
                                            alerts(resultData.ResultType.MessageList[0]);
                                        }
                                        $(dt_OgrenciSozlesme).LoadingOverlay("hide");
                                    });
                                }
                            });
                        });

                        $('.dt-buttons').css('float', 'right');
                        $('.dt-buttons').css('margin-left', '20px');
                        $('.dt-buttons').css('margin-top', '16px');

                        $(dt_OgrenciSozlesme).LoadingOverlay("hide");
                        ayarlar();
                    },
                    "language": {
                        "url": "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Turkish.json",
                    },
                    "dom": 'lBfrtip',
                    "buttons": ['copy', 'csv', 'excel', 'pdf'],
                    "destroy": true,
                    "caseInsensitive": true,
                    "serverSide": true,
                    "responsive": true,
                    "pageLength": 100,
                    "DisplayLength": 100,
                    "lengthMenu": [[100, 250, 500, 1000, 2500, 5000], [100, 250, 500, 1000, 2500, 5000]],
                    "lengthChange": true,
                    "processing": true,
                    "columnDefs": [
                        //{ "orderable": false, "targets": [0, 1] },
                    ],
                    "columns": columns,

                });

            },


        }
        OgrenciSozlesme_ListFunc.load();

    });


</script>
